---
title: "analysis"
author: "Solon Ioannou"
date: "6/25/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(arules)
library(arulesViz)
library(rCBA)
library(tidyverse)
```

```{r}
data1 <- readRDS("../data/processed/eunomia_trans.rds")
#data2 <- readRDS("../data/processed/synthea60k_trans.rds")
```

```{r}
itemfreq1 <- itemFrequency(data1) #gives support fr each item
sort(itemfreq1, decreasing = TRUE)

#itemfreq2 <- itemFrequency(data2) #gives support fr each item
#sort(itemfreq2, decreasing = TRUE)
itemFrequencyPlot(data1, support = 0, cex.names = 0.5)
#itemFrequencyPlot(data2, support = 0.01, cex.names = 0.8)
```

```{r}
#Define parameters for apriori algorithm. See ?APparameter for more details
ap_params <- list(
  support = 0.5, 
  confidence = 0.5, 
  minlen = 1,     #number of items per itemset
  maxlen = 50,    #maximal number of items per itemset 
  arem = "chi2",  #additional rule evaluation
  aval = TRUE,    #return additional rule measure
  minval = 0,   #default value for minimal value of additional rule measure
  maxtime = 0     #Disabling he limit for subset checking
)

```


```{r}
rules1 <- apriori(data1, parameter = list(support = 0.5, confidence = 0.5))
rules1 <- apriori(data1, parameter = ap_params)
rules1
summary(rules1)
rules_insp1 <- inspect(rules1)
rules_conf1 <- sort(rules1, by="confidence", decreasing=TRUE) # 'high-confidence' rules.
inspect(rules_conf1)
inspect(head(rules_conf1))
inspect(tail(rules_conf1))

rules_chisqu1 <- sort(rules1, by="chi2", decreasing=TRUE) # 'high-confidence' rules.
inspect(rules_chisqu1)
```

```{r}
plot(rules1)
```

```{r}
plot(rules1, method = "graph",  engine = "htmlwidget")
```

# ECLAT

```{r}
itemsets_ec <- eclat(data1, parameter = list(supp=0.03, maxlen=30))
rules_ec <- ruleInduction(itemsets_ec, data1, confidence = 0.9)

#inspect(sort(rules_ec, by = "lift"))
subset.rules_ec <- which(colSums(is.subset(rules_ec, rules_ec)) > 1) # get subset rules in vector
length(subset.rules_ec)  #

subset.association.rules_ec <- rules_ec[-subset.rules_ec] # remove subset rules.
inspect(sort(subset.association.rules_ec, by = "lift"))
```


# FP-growth

```{r}
rules_fp <- buildFPGrowth(data1, support=0.03, confidence=0.03, maxLength=2, parallel=FALSE)
```



