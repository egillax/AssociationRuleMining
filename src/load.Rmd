---
title: "Data Import"
author: "Solon Ioannou"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
#Loading libraries
library(Eunomia)
#Set up connection details
connectionDetails <- getEunomiaConnectionDetails()
connection <- connect(connectionDetails)
```

```{r, include=FALSE}
pat_obs <- querySql(connection, "SELECT COUNT(*) FROM person;")
cond_obs <- querySql(connection, "SELECT COUNT(*) FROM condition_occurrence;")
vis_obs <- querySql(connection, "SELECT COUNT(*) FROM visit_occurrence;")
```

```{r, include=FALSE}
df <- querySql(connection, "
SELECT cond.PERSON_ID AS ID, CONDITION_CONCEPT_ID, CONDITION_SOURCE_VALUE, cond.VISIT_OCCURRENCE_ID, cond.CONDITION_START_DATE, conc.CONCEPT_NAME  
FROM condition_occurrence AS cond INNER JOIN CONCEPT AS conc ON CONDITION_CONCEPT_ID = CONCEPT_ID; ")
```

```{r, include=FALSE}
disconnect(connection)
```

```{r, include=FALSE}
saveRDS(object = df, file = "../data/raw/eunomia.rds")
```

### REPORT 

Date: `r Sys.time()`

The loaded database contains information from `r pat_obs`, with a total of `r cond_obs` encounters in the condition_occurrence table that describe symptoms, diagnoses and events. The total number of recorded visits is `r vis_obs`.      
  
To do:  
- Successful/Error in connection  
- Successful/Error in sql query  
- Add description of the query  
- Add description of the final df  
  
All data is stored as a dataframe named df in the /data/raw folder.   

